<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  <head>
    <title>
      UsingMarkup – Django
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/wiki/UsingMarkup?format=txt" type="text/x-trac-wiki" title="Plain Text" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/wiki.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search Django" />
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <link rel="alternate" type="application/x-wiki" title="Edit this page" href="/wiki/UsingMarkup?action=edit" />
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/chrome/site/style.css" />
  </head>
  <body>
    <div id="django-code">
      <div id="django-container">
        <div id="django-header">
          <h1 id="django-logo"><a href="https://www.djangoproject.com/"><img src="https://www.djangoproject.com/m/img/site/hdr_logo.gif" alt="Django" /></a></h1>
          <ul id="django-nav-global">
            <li><a href="https://www.djangoproject.com/">Home</a></li>
            <li><a href="https://www.djangoproject.com/download/">Download</a></li>
            <li><a href="https://docs.djangoproject.com/">Documentation</a></li>
            <li><a href="https://www.djangoproject.com/weblog/">Weblog</a></li>
            <li><a href="https://www.djangoproject.com/community/">Community</a></li>
            <li id="django-active-nav"><a href="/">Code</a></li>
          </ul>
        </div>
        <div id="django-billboard"><h2><a href="/">Code</a></h2></div>
        <div id="django-columnwrap">
          <div id="django-content-main">
    <div id="banner">
      <div id="header">
        <a id="logo" href="https://www.djangoproject.com/"><img src="https://www.djangoproject.com/m/img/site/hdr_logo.gif" alt="Django" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li><a href="https://www.djangoproject.com/accounts/register/">Register</a></li><li><a href="/prefs">Preferences</a></li><li class="last"><a href="https://www.djangoproject.com/accounts/password/reset/">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/browser">Browse Source</a></li><li><a href="/wiki/Reports">Reports</a></li><li><a href="/query">View Tickets</a></li><li><a href="/newticket">New Ticket</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="View WikiStart" href="/wiki">wiki:</a><a class="pathentry" href="/wiki/UsingMarkup" title="View UsingMarkup">UsingMarkup</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="/wiki/WikiStart">Start Page</a></li><li><a href="/wiki/TitleIndex">Index</a></li><li class="last"><a href="/wiki/UsingMarkup?action=history">History</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          
          <div class="trac-modifiedby"><a href="/wiki/UsingMarkup?action=diff&amp;version=13" title="Version 13 by Collin Grady &lt;cgrady@…&gt;">Last modified</a> <a class="timeline" href="/timeline?from=2007-04-20T18%3A25%3A15-07%3A00&amp;precision=second" title="2007-04-20T18:25:15-07:00 in Timeline">5 years</a> ago</div>
          <div id="wikipage"><h1 id="CookBook-UsingMarkupFiltersinModels"><a class="wiki" href="/wiki/CookBook">CookBook</a> - Using Markup Filters in Models</h1>
<p>
The markup application (django.contrib.markup) is pretty handy for using filters like Textile or Markdown in your templates, but has a slight downside: every time a page is generated, you have to run the markup filter over the text, which may or may not be an acceptable performance hit. You could, if you wanted, just define a save() hook which applies the filter to incoming text so it gets saved to your DB as HTML, but then you're in a pickle if you want to edit it again later. What to do, then?
</p>
<p>
One solution is found in the Textpattern CMS, which incorporates Textile. Textpattern accepts input in Textile syntax, and then saves two copies: one is the raw input, which is stored for later use when an item is being edited, and the other is the XHTML Textile produces for that input, which is used for actual page display. The idea here is that database columns are cheap, but processing time might not be. And this is easy to do in Django; for example, let's say you have a weblog where you'd like to use Markdown on the entries. You might define your Entry model like so:
</p>
<div class="code"><pre>
<span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span>models<span class="o">.</span>Model<span class="p">):</span>
    title <span class="o">=</span> models<span class="o">.</span>CharField<span class="p">(</span><span class="s">'Title'</span><span class="p">,</span> maxlength<span class="o">=</span><span class="mi">250</span><span class="p">)</span>
    pub_date <span class="o">=</span> models<span class="o">.</span>DateTimeField<span class="p">(</span><span class="s">'Date published'</span><span class="p">,</span> default<span class="o">=</span>datetime<span class="o">.</span>now<span class="p">)</span>
    body_markdown <span class="o">=</span> models<span class="o">.</span>TextField<span class="p">(</span><span class="s">'Entry body'</span><span class="p">,</span> help_text<span class="o">=</span><span class="s">'Use Markdown syntax.'</span><span class="p">)</span>
    body <span class="o">=</span> models<span class="o">.</span>TextField<span class="p">(</span><span class="s">'Entry body as HTML'</span><span class="p">,</span> blank<span class="o">=</span><span class="bp">True</span><span class="p">,</span> null<span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Admin</span><span class="p">:</span>
        fields <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">{</span><span class="s">'fields'</span><span class="p">:</span> <span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'pub_date'</span><span class="p">,</span> <span class="s">'body_markdown'</span><span class="p">)}),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">markdown</span>
        <span class="bp">self</span><span class="o">.</span>body <span class="o">=</span> markdown<span class="o">.</span>markdown<span class="p">(</span><span class="bp">self</span><span class="o">.</span>body_markdown<span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span>Entry<span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span>save<span class="p">()</span> <span class="c"># Call the "real" save() method.</span>
</pre></div><p>
Now you've got the same effect: when creating or editing entries in the admin, you'll only see the field which accepts Markdown syntax (body_markdown), but when saving, the "body" field will be auto-filled with the corresponding XHTML. Then in your template, you can pull in entry.body, and save yourself a little processing time everytime the page is loaded.
</p>
</div>
        
        
      </div>
      
    <div id="attachments">
    </div>

          <div class="buttons">
              <form method="get" action="/wiki/UsingMarkup" id="modifypage">
                <div>
                  <input type="hidden" name="action" value="edit" />
                      <input type="submit" value="Edit this page" />
                </div>
              </form>
                <form method="get" action="/attachment/wiki/UsingMarkup/" id="attachfile">
  <div>
    <input type="hidden" name="action" value="new" />
    <input type="submit" name="attachfilebutton" value="Attach file" />
  </div>
</form>
          </div>
    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="/wiki/UsingMarkup?format=txt">Plain Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"></p>
    </div>
          </div>
        </div>
        <div id="django-footer">
          <p>© 2005-2010 <a href="https://www.djangoproject.com/foundation/">Django Software Foundation</a> unless otherwise noted. Django is a registered trademark of the Django Software Foundation.
          <a href="http://mediatemple.net/">Linux Web hosting</a> graciously provided by Media Temple.
          </p>
        </div>
      </div>
    </div>
  </body>
</html>